<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat App (Static UI)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">    <style>
        /* CSS Variables for Theme Support */
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: rgba(255, 255, 255, 0.95);
            --bg-chat: rgba(255, 255, 255, 0.8);
            --bg-sidebar: rgba(255, 255, 255, 0.1);
            --bg-message-user: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-message-ai: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --bg-input: #ffffff;
            --bg-button: rgba(255, 255, 255, 0.2);
            --bg-dropdown: #ffffff;
            
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-tertiary: #9ca3af;
            --text-white: #ffffff;
            --text-sidebar: #ffffff;
            
            --border-color: rgba(0, 0, 0, 0.1);
            --border-light: #e5e7eb;
            --border-sidebar: rgba(255, 255, 255, 0.2);
            
            --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 15px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.2);
            
            --backdrop-blur: blur(10px);
        }

        [data-theme="dark"] {
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --bg-tertiary: rgba(31, 41, 55, 0.95);
            --bg-chat: rgba(17, 24, 39, 0.8);
            --bg-sidebar: rgba(0, 0, 0, 0.3);
            --bg-message-user: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            --bg-message-ai: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --bg-input: #374151;
            --bg-button: rgba(0, 0, 0, 0.3);
            --bg-dropdown: #374151;
            
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-tertiary: #9ca3af;
            --text-white: #ffffff;
            --text-sidebar: #ffffff;
            
            --border-color: rgba(255, 255, 255, 0.1);
            --border-light: #374151;
            --border-sidebar: rgba(255, 255, 255, 0.2);
            
            --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 15px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.4);
            
            --backdrop-blur: blur(15px);
        }

        /* Custom CSS for smooth transitions and parallax */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow-x: hidden; /* Prevent horizontal scroll */
            min-height: 100vh; /* Ensure body takes full viewport height */
            height: 100vh; /* Explicitly define height for consistent centering */
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }        .parallax-bg {
            background: linear-gradient(to bottom right, #4a00e0, #8e2de2);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            transform: translateZ(0);
            transition: all 0.3s ease-out;
        }
        
        [data-theme="dark"] .parallax-bg {
            background: linear-gradient(to bottom right, #1a1a2e, #16213e);
        }.form-container {
            backdrop-filter: var(--backdrop-blur); /* Frosted glass effect */
            background-color: var(--bg-sidebar);
            border-radius: 1.5rem; /* More rounded */
            padding: 2.5rem; /* More padding */
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease-in-out;
        }
        .input-field {
            background-color: var(--bg-input);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
            padding: 0.75rem 1rem;
            border-radius: 0.75rem; /* Rounded input fields */
            transition: all 0.2s ease-in-out;
        }
        .input-field::placeholder {
            color: var(--text-tertiary);
        }
        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }
        .btn-primary {
            background: linear-gradient(to right, #6d28d9, #9333ea);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        .btn-link {
            color: #d8b4fe; /* Lighter purple */
            transition: color 0.2s ease-in-out;
        }
        .btn-link:hover {
            color: #f0e6ff;
        }        /* Chat specific styles */
        .chat-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
        }        .sidebar {
            width: 280px;
            background: var(--bg-sidebar);
            backdrop-filter: var(--backdrop-blur);
            border-right: 1px solid var(--border-sidebar);
            color: var(--text-sidebar);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            z-index: 1000;
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.open {
            transform: translateX(0);
        }
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .sidebar-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        .chat-main {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-tertiary);
            backdrop-filter: var(--backdrop-blur);
            width: 100%;
        }        .chat-header {
            background: var(--bg-secondary);
            backdrop-filter: var(--backdrop-blur);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-sm);
            position: relative;
        }
        .menu-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            color: var(--text-primary);
        }
        .menu-button:hover {
            background: var(--border-color);
        }
        .menu-button i {
            font-size: 1.2rem;
        }
        .user-menu {
            position: relative;
        }
        .user-menu-button {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-input);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
        }
        .user-menu-button:hover {
            background: var(--bg-secondary);
            box-shadow: var(--shadow-sm);
        }
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: var(--bg-dropdown);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            border: 1px solid var(--border-light);
        }
        .user-dropdown.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.2s ease;
            color: var(--text-primary);
        }
        .user-dropdown-item:hover {
            background: var(--border-color);
        }
        .user-dropdown-item:first-child {
            border-radius: 12px 12px 0 0;
        }
        .user-dropdown-item:last-child {
            border-radius: 0 0 12px 12px;
            border-top: 1px solid var(--border-light);
            color: #dc2626;
        }
        .user-dropdown-item:last-child:hover {
            background: rgba(220, 38, 38, 0.1);
        }
        
        /* Theme Toggle Button */
        .theme-toggle {
            background: var(--bg-button);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 0.5rem;
        }
        .theme-toggle:hover {
            background: var(--border-color);
            transform: scale(1.05);
        }        .chat-messages {
            flex-grow: 1;
            padding: 1.5rem;
            padding-bottom: 160px; /* More space for fixed input */
            overflow-y: auto;
            scroll-behavior: smooth;
            background: var(--bg-chat);
            display: flex;
            flex-direction: column;
            gap: 1rem;
            scrollbar-width: thin;
            scrollbar-color: var(--text-tertiary) transparent;
            height: calc(100vh - 120px); /* Ensure proper height */
        }
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }
        .chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--text-tertiary);
            border-radius: 3px;
        }
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background-color: var(--text-secondary);
        }        .message-box {
            max-width: min(75%, 500px);
            min-width: 100px;
            padding: 0.5rem 0;
            border-radius: 0;
            word-wrap: break-word;
            word-break: break-word;
            white-space: pre-wrap;
            box-shadow: none;
            background: transparent;
            border: none;
            position: relative;
            animation: messageSlideIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            line-height: 1.5;
            width: fit-content;
            margin: 0.5rem 0;            transition: none;
            font-size: 0.9rem;
        }
        .message-box.short-message {
            max-width: min(50%, 350px);
        }
        .message-box.medium-message {
            max-width: min(65%, 450px);
        }
        .message-box.long-message {
            max-width: min(75%, 500px);
        }        .message-box p {
            margin: 0;
            padding: 0;
            line-height: 1.4;
            overflow-wrap: break-word;
            hyphens: auto;
        }
        .message-box .message-content {
            margin: 0;
            padding: 0;
        }
        .message-box .message-content p {
            margin: 0 !important;
            padding: 0 !important;
        }
        .message-box .message-content {
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        }
        .message-box .message-content::-webkit-scrollbar {
            width: 4px;
        }
        .message-box .message-content::-webkit-scrollbar-track {
            background: transparent;
        }
        .message-box .message-content::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }
        .message-box .message-content::-webkit-scrollbar-thumb:hover {
            background-color: rgba(255, 255, 255, 0.5);
        }
        .expand-btn {
            background: none;
            border: none;
            color: inherit;
            font-size: 0.75rem;
            text-decoration: underline;
            cursor: pointer;
            opacity: 0.75;
            transition: opacity 0.2s ease;
        }
        .expand-btn:hover {
            opacity: 1;
        }
        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }        .user-message {
            background: transparent;
            color: var(--text-primary);
            align-self: flex-end;
            border-bottom-right-radius: 0;
        }

        .user-message::after {
            display: none;
        }

        .ai-message {
            background: transparent;
            color: var(--text-primary);
            align-self: flex-start;
            border-bottom-left-radius: 0;
        }

        .ai-message::after {
            display: none;
        }.chat-input-area {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1.5rem;
            background: var(--bg-tertiary);
            backdrop-filter: var(--backdrop-blur);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: flex-end;
            gap: 1rem;
            z-index: 100;
            box-shadow: var(--shadow-md);
        }
        .input-container {
            flex-grow: 1;
            position: relative;
            background: var(--bg-input);
            border-radius: 25px;
            border: 2px solid var(--border-light);
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }
        .input-container:focus-within {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        .chat-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: none;
            border-radius: 25px;
            outline: none;
            resize: none;
            max-height: 120px;
            min-height: 50px;
            font-size: 1rem;
            line-height: 1.5;
            background: transparent;
            color: var(--text-primary);
        }        .chat-input::placeholder {
            color: var(--text-tertiary);        }
        .send-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-white);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }
        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        .send-button:active {
            transform: translateY(0);
        }
        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            pointer-events: none;
        }
        .send-button:disabled:hover {
            transform: none;
            box-shadow: var(--shadow-md);
        }        .typing-indicator {
            display: none;
            align-items: center;
            gap: 0.75rem;
            color: #22c55e;
            font-style: italic;
            position: fixed;
            bottom: 110px;
            left: 1.5rem;
            z-index: 99;
            background: var(--bg-tertiary);
            backdrop-filter: var(--backdrop-blur);
            padding: 1rem 1.25rem;
            border-radius: 25px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .thinking-animation {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .brain-icon {
            font-size: 1.2rem;
            animation: brainPulse 2s ease-in-out infinite;
        }
        
        @keyframes brainPulse {
            0%, 100% { 
                transform: scale(1); 
                opacity: 0.7; 
            }
            50% { 
                transform: scale(1.1); 
                opacity: 1; 
            }
        }
        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #667eea;
            animation: typingDots 1.5s infinite;
        }
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typingDots {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            30% {
                opacity: 1;
                transform: scale(1);
            }
        }        .new-chat-btn {
            background: var(--bg-button);
            border: 1px solid var(--border-sidebar);
            color: var(--text-sidebar);
            padding: 0.75rem 1rem;
            border-radius: 12px;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
            width: 100%;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .new-chat-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        .chat-history-list {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 1rem;
        }        .chat-history-item {
            background: var(--bg-button);
            border: 1px solid var(--border-sidebar);
            color: var(--text-sidebar);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            width: 100%;
            font-size: 0.9rem;
        }
        .chat-history-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }
        .chat-history-item.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }
        .chat-preview {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 0.25rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Responsive Design for Mobile */
        @media (max-width: 768px) {
            .chat-container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
                max-height: 200px;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            }
            .chat-main {
                height: calc(100vh - 200px);
            }
            .message-box {
                max-width: 90%;
            }
            .chat-input-area {
                padding: 1rem;
                gap: 0.5rem;
            }
            .send-button {
                width: 45px;
                height: 45px;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                max-height: 150px;
                padding: 1rem;
            }
            .chat-header {
                padding: 0.75rem 1rem;
            }
            .chat-messages {
                padding: 1rem;
            }
            .message-box {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            .chat-input-area {
                padding: 0.75rem;
            }
            .chat-input {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
        }        /* Profile page styles */
        .profile-container {
            background-color: var(--bg-secondary);
            border-radius: 1.5rem;
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
            max-width: 600px;
            margin: 2rem auto;
            text-align: center;
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }
        .profile-avatar {
            width: 120px;
            height: 120px;
            background-color: #a78bfa;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            border: 4px solid #ede9fe;
        }

        /* Animation classes */
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s cubic-bezier(.4,0,.2,1) forwards;
        }
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .slide-in {
            opacity: 0;
            transform: translateX(40px);
            animation: slideIn 0.5s cubic-bezier(.4,0,.2,1) forwards;
        }
        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        .scale-on-hover {
            transition: transform 0.15s cubic-bezier(.4,0,.2,1), box-shadow 0.15s;
        }
        .scale-on-hover:hover {
            transform: scale(1.07);
            box-shadow: 0 8px 24px rgba(109,40,217,0.18);
        }
        .btn-primary, .send-button, .btn-link {
            transition: transform 0.15s cubic-bezier(.4,0,.2,1), box-shadow 0.15s;
        }
        .btn-primary:active, .send-button:active {
            transform: scale(0.97);
        }
        .chat-input-area {
            transition: box-shadow 0.2s, background 0.3s;
        }
        .chat-input-area:focus-within {
            box-shadow: 0 0 0 6px #c4b5fd55;
            background: #ede9fe;
        }
        .sidebar {
            transition: box-shadow 0.3s, background 0.3s;
        }
        .sidebar:hover {
            box-shadow: 0 12px 32px rgba(76,29,149,0.16);
            background: #312e81;
        }
        .profile-avatar, .profile-avatar-small {
            transition: box-shadow 0.3s, transform 0.3s;
        }
        .profile-avatar:hover, .profile-avatar-small:hover {
            box-shadow: 0 8px 32px #a78bfa55;
            transform: scale(1.08) rotate(-2deg);
        }        .message-box {
            transition: none;
        }
        /* Parallax background animation */
        .parallax-bg {
            transition: transform 0.7s cubic-bezier(.4,0,.2,1), filter 0.5s;
            filter: blur(0px) brightness(1);
        }
        .parallax-bg.active {
            filter: blur(2px) brightness(1.1);
        }
        /* Modal pop effect */
        .modal-pop {
            animation: popIn 0.4s cubic-bezier(.4,0,.2,1);
        }
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.8); }
            80% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .form-container {
                padding: 2rem;
                margin: 0.5rem;
                width: 95%;
            }
            .chat-container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid #2d3748;
                padding-bottom: 0.5rem;
            }
            .chat-messages {
                padding: 1rem;
            }
            .message-box {
                max-width: 90%;
            }
        }

        /* Profile form elements */
        .profile-container input[type="text"],
        .profile-container input[type="email"] {
            background-color: var(--bg-input);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }
        
        .profile-container input[type="text"]:focus,
        .profile-container input[type="email"]:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        
        /* Login form elements */
        input[type="text"],
        input[type="email"],
        input[type="password"] {
            background-color: var(--bg-input);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }
        
        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        
        .chat-input:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: var(--border-light);
        }
        
        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            pointer-events: none;
        }
        
        .send-button:disabled:hover {
            transform: none;
            box-shadow: var(--shadow-md);
        }

        /* Dark mode overrides for AI messages */
        [data-theme="dark"] .ai-message {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }
        
        [data-theme="dark"] .ai-message::after {
            border-right: 8px solid rgba(5, 150, 105, 0.8);
        }
        
        [data-theme="dark"] .typing-indicator {
            color: #10b981;
        }

        /* --- PROFILE ICON: Prevent hover/fade, ensure visibility --- */
        .user-menu-button,
        .user-menu-button:hover,
        .user-menu-button:active {
            background: none !important;
            color: var(--text-primary) !important;
            filter: none !important;
            opacity: 1 !important;
            transition: none !important;
        }
        [data-theme="dark"] .user-menu-button,
        [data-theme="dark"] .user-menu-button:hover {
            color: #fff !important;
        }
        [data-theme="light"] .user-menu-button,        [data-theme="light"] .user-menu-button:hover {
            color: #222 !important;
        }

        /* --- SIDEBAR: Prevent hover/fade, static color --- */
        .sidebar,
        .sidebar:hover {
            background: #312e81 !important;
            box-shadow: none !important;
            transition: none !important;
        }

        /* --- CHATBOX: Hide side scroll bar in messages --- */
        .chat-messages {
            overflow-y: auto;
            overflow-x: hidden !important;
        }
        .chat-messages::-webkit-scrollbar {
            height: 0 !important;
        }

        /* --- CHATBOX: Prevent focus/active color change, keep static --- */
        .chat-input-area,
        .chat-input-area:focus-within {
            background: var(--bg-tertiary) !important;
            box-shadow: var(--shadow-md) !important;
            transition: none !important;
        }

        /* --- MESSAGE BOX: Prevent hover/focus color change, static color, ensure text visible in dark mode --- */
        .message-box,
        .message-box.user-message,
        .message-box.ai-message {
            background: inherit !important;
            color: var(--text-primary) !important;
        }
        .message-box:hover,
        .message-box.user-message:hover,
        .message-box.ai-message:hover,
        .message-box:active,
        .message-box.user-message:active,
        .message-box.ai-message:active {
            background: inherit !important;
            color: var(--text-primary) !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15) !important;
            transform: none !important;
        }
        [data-theme="dark"] .message-box,
        [data-theme="dark"] .message-box.user-message,
        [data-theme="dark"] .message-box.ai-message {
            color: #fff !important;
        }
        [data-theme="light"] .message-box,
        [data-theme="light"] .message-box.user-message,
        [data-theme="light"] .message-box.ai-message {
            color: #222 !important;
        }
        /* Remove extra margin/padding and empty lines in AI message box */
        .ai-message.message-box {
            margin-top: 0.75rem !important;
            margin-bottom: 0.75rem !important;
            padding-top: 1.25rem !important;
            padding-bottom: 1.25rem !important;
        }
        .ai-message.message-box > *:first-child {
            margin-top: 0 !important;
        }
        .ai-message.message-box > *:last-child {
            margin-bottom: 0 !important;
        }
        .ai-message.message-box p {
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }
        .ai-message.message-box .message-content {
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }
        
        /* Remove background box for AI message in all modes */
        .ai-message.message-box,
        [data-theme="dark"] .ai-message.message-box {
            background: none !important;
            border: none !important;
            box-shadow: none !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            padding: 0.75rem 1.25rem !important;
            margin: 0.5rem 0 !important;
        }

        /* Remove extra space between sender and message for both user and AI */
        .message-box > .flex,
        .message-box > .font-semibold,
        .message-box > p,
        .message-box > .message-content {
            margin-top: 0 !important;
            margin-bottom: 0 !important;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
            line-height: 1.4 !important;
        }

        /* Remove margin from message box itself */
        .message-box {
            margin-top: 0.5rem !important;
            margin-bottom: 0.5rem !important;
            padding-top: 0.5rem !important;
            padding-bottom: 0.5rem !important;
        }

        /* Remove bottom margin from sender label if using .mb-2 or similar */
        .message-box > .mb-2 {
            margin-bottom: 0 !important;
        }

        /* Compact chat message box for both user and AI */
        .message-box {
            max-width: 350px !important;
            min-width: 60px !important;
            padding: 0.4rem 0.8rem !important;
            border-radius: 14px !important;
            margin: 0.3rem 0 !important;
            font-size: 0.97rem !important;
            line-height: 1.35 !important;
            box-shadow: none !important;
            background: none !important;
        }

        /* Remove all extra spacing inside message box */
        .message-box > .flex,
        .message-box > .font-semibold,
        .message-box > p,
        .message-box > .message-content {
            margin: 0 !important;
            padding: 0 !important;
            line-height: 1.35 !important;
        }
        .message-box > .mb-2 {
            margin-bottom: 0 !important;
        }
        .message-box > *:first-child,
        .message-box > *:last-child {
            margin-top: 0 !important;
            margin-bottom: 0 !important;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
        }

        /* --- PROFILE PAGE: Back button visible and color matches palette --- */
        #back-to-chat-button {
            background: #a78bfa !important;
            color: #fff !important;
            border: none !important;
            box-shadow: 0 2px 8px #a78bfa33 !important;
            transition: background 0.2s, color 0.2s;
            opacity: 1 !important;
            visibility: visible !important;
        }
        #back-to-chat-button:hover {
            background: #7c3aed !important;
            color: #fff !important;
        }
        #back-to-chat-button i {
            color: #fff !important;
        }

        /* --- AI MESSAGE: Glassmorphism style, no default box, green accent --- */
        .ai-message.message-box {
            background: rgba(39, 174, 96, 0.18) !important;
            border: 1.5px solid rgba(34, 197, 94, 0.25) !important;
            box-shadow: 0 8px 32px 0 rgba(34, 197, 94, 0.18), 0 1.5px 8px 0 rgba(0,0,0,0.10) !important;
            backdrop-filter: blur(8px) !important;
            -webkit-backdrop-filter: blur(8px) !important;
            border-radius: 24px !important;
            color: #fff !important;
            font-weight: bold !important;
            padding: 1.25rem 1.75rem !important;
            margin: 0.75rem 0 !important;
            transition: box-shadow 0.2s, background 0.3s;
        }
        .ai-message.message-box .font-semibold {
            color: #22c55e !important;
            font-weight: bold !important;
        }
        .ai-message.message-box i {
            color: #22c55e !important;
        }
        /* Remove triangle pointer for AI message */
        .ai-message::after {
            display: none !important;
        }        /* --- DARK MODE: Make all message, chat history, and profile text bold and white for visibility --- */
        [data-theme="dark"] .message-box,
        [data-theme="dark"] .message-box.user-message,
        [data-theme="dark"] .message-box.ai-message,
        [data-theme="dark"] .chat-history-item,
        [data-theme="dark"] .profile-container,
        [data-theme="dark"] .profile-container h2,
        [data-theme="dark"] .profile-container p,
        [data-theme="dark"] .profile-container .font-semibold,
        [data-theme="dark"] .profile-container .text-sm,
        [data-theme="dark"] .profile-container .text-gray-600,
        [data-theme="dark"] .profile-container .text-gray-700,
        [data-theme="dark"] #profile-username-display,
        [data-theme="dark"] #profile-display-username,
        [data-theme="dark"] #profile-display-email,
        [data-theme="dark"] #profile-display-phone {
            color: #fff !important;
            font-weight: bold !important;
        }
        [data-theme="dark"] .profile-container .bg-gray-50 {
        background-color: #23263a !important;
        color: #fff !important;
        }
        [data-theme="dark"] .profile-container .font-semibold,
        [data-theme="dark"] .profile-container .text-sm,
        [data-theme="dark"] .profile-container .text-gray-700 {
            color: #fff !important;
            font-weight: bold !important;
        }
        [data-theme="dark"] .profile-container button {
            color: #a78bfa !important;
            font-weight: bold !important;
        }        [data-theme="dark"] .chat-header h2,
        [data-theme="dark"] .chat-header p {
        color: #fff !important;
        font-weight: bold !important;
        }        /* --- DARK MODE: User menu and profile elements visibility --- */
        [data-theme="dark"] .user-menu-button span,
        [data-theme="dark"] .user-menu .font-medium,
        [data-theme="dark"] .sidebar .font-medium,
        [data-theme="dark"] .sidebar span,
        [data-theme="dark"] .text-gray-700,
        [data-theme="dark"] .text-gray-600,
        [data-theme="dark"] .text-gray-500 {
            color: #fff !important;
            font-weight: bold !important;
        }

        /* --- DARK MODE: Ensure all sidebar text is visible --- */
        [data-theme="dark"] .sidebar * {
            color: #fff !important;
        }

        /* --- PROFILE PAGE: Make info text bold in all themes --- */
        .profile-container h2,
        .profile-container p,
        .profile-container .font-semibold,
        .profile-container .text-sm {
            font-weight: bold !important;
        }

        /* --- CHAT HISTORY: Hide horizontal scroll and make text bold in dark mode --- */
        .chat-history-list {
            overflow-x: hidden !important;
        }
        [data-theme="dark"] .chat-history-item {
            color: #fff !important;
            font-weight: bold !important;
        }
        .chat-history-item {
            font-weight: bold !important;
        }

        /* --- MESSAGE BOX: Make text bold in all themes --- */
        .message-box,
        .message-box.user-message,
        .message-box.ai-message {
            font-weight: bold !important;
        }


    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center relative overflow-hidden">

    <!-- Parallax Background -->
    <div id="parallax-bg" class="parallax-bg"></div>

    <!-- Main Content Area -->
    <div id="app-container" class="w-full h-full flex items-center justify-center relative z-10 transition-opacity duration-500">

        <!-- Login Page -->
        <div id="login-page" class="absolute inset-0 flex items-center justify-center p-4 transition-all duration-500 opacity-100 z-20">
            <div class="form-container w-full max-w-md text-white">
                <h2 class="text-4xl font-bold text-center mb-6 text-purple-200">Welcome Back!</h2>
                <form id="login-form" class="space-y-6">
                    <div>
                        <label for="login-email-username" class="block text-sm font-medium text-purple-100 mb-2">Email address or Username</label>
                        <input type="text" id="login-email-username" class="input-field w-full" placeholder="you@example.com or username" required>
                    </div>
                    <div>
                        <label for="login-password" class="block text-sm font-medium text-purple-100 mb-2">Password</label>
                        <input type="password" id="login-password" class="input-field w-full" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                    </div>
                    <button type="submit" class="btn-primary w-full">Login</button>
                    <p class="text-center text-sm text-purple-100">
                        Don't have an account? <a href="#" id="show-signup" class="btn-link font-medium">Sign Up</a>
                    </p>
                </form>
            </div>
        </div>

        <!-- Sign Up Page -->
        <div id="signup-page" class="absolute inset-0 flex items-center justify-center p-4 transition-all duration-500 opacity-0 -translate-x-full z-10">
            <div class="form-container w-full max-w-md text-white">
                <h2 class="text-4xl font-bold text-center mb-6 text-purple-200">Join Us Today!</h2>
                <form id="signup-form" class="space-y-6">
                    <div>
                        <label for="signup-username" class="block text-sm font-medium text-purple-100 mb-2">Username</label>
                        <input type="text" id="signup-username" class="input-field w-full" placeholder="Your unique username" required>
                    </div>
                    <div>
                        <label for="signup-email" class="block text-sm font-medium text-purple-100 mb-2">Email address</label>
                        <input type="email" id="signup-email" class="input-field w-full" placeholder="you@example.com" required>
                    </div>
                    <div>
                        <label for="signup-phone" class="block text-sm font-medium text-purple-100 mb-2">Phone Number (Optional)</label>
                        <input type="tel" id="signup-phone" class="input-field w-full" placeholder="e.g., +1234567890">
                    </div>
                    <div>
                        <label for="signup-password" class="block text-sm font-medium text-purple-100 mb-2">Password</label>
                        <input type="password" id="signup-password" class="input-field w-full" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                    </div>
                    <div>
                        <label for="signup-confirm-password" class="block text-sm font-medium text-purple-100 mb-2">Confirm Password</label>
                        <input type="password" id="signup-confirm-password" class="input-field w-full" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                    </div>
                    <button type="submit" class="btn-primary w-full">Sign Up</button>
                    <p class="text-center text-sm text-purple-100">
                        Already have an account? <a href="#" id="show-login" class="btn-link font-medium">Login</a>
                    </p>
                </form>
            </div>
        </div>        <!-- Chat Application -->
        <div id="chat-app" class="absolute inset-0 flex flex-col chat-container opacity-0 translate-x-full transition-all duration-500 hidden">
            <!-- Sidebar overlay -->
            <div id="sidebar-overlay" class="sidebar-overlay"></div>
            
            <!-- Sidebar for Chat History -->
            <div id="sidebar" class="sidebar">
                <h3 class="text-2xl font-bold mb-6 text-white">ðŸ’¬ AI Chat</h3>
                <button id="new-chat-btn" class="new-chat-btn">
                    <i class="fas fa-plus"></i>
                    <span>New Chat</span>
                </button>
                <div id="chat-history-list" class="chat-history-list">
                    <!-- Chat history items will be dynamically added here -->
                </div>
            </div>

            <!-- Main Chat Area -->
            <div class="chat-main">
                <!-- Chat Header -->
                <div class="chat-header">
                    <div class="flex items-center gap-3">
                        <button id="menu-button" class="menu-button">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-robot text-white"></i>
                        </div>
                        <div>
                            <h2 id="current-chat-title" class="text-xl font-bold text-gray-800">AI Assistant</h2>
                            <p class="text-sm text-gray-600">Online â€¢ Ready to help</p>
                        </div>
                    </div>
                      <!-- Theme Toggle and User Menu -->
                    <div class="flex items-center gap-2">
                        <!-- Theme Toggle Button -->
                        <button id="theme-toggle" class="theme-toggle" title="Toggle dark/light mode">
                            <i class="fas fa-sun" id="theme-icon"></i>
                        </button>
                        
                        <!-- User Menu -->
                        <div class="user-menu">
                            <div id="user-menu-button" class="user-menu-button">
                                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 text-white flex items-center justify-center rounded-full text-sm font-bold">
                                    <i class="fas fa-user"></i>
                                </div>
                                <span id="profile-username-display" class="font-medium text-gray-700">User</span>
                                <i class="fas fa-chevron-down text-gray-500"></i>
                            </div>
                          <!-- User Dropdown -->
                        <div id="user-dropdown" class="user-dropdown">
                            <div id="profile-menu-item" class="user-dropdown-item">
                                <i class="fas fa-user-circle"></i>
                                <span>View Profile</span>
                            </div>
                            <div id="logout-menu-item" class="user-dropdown-item">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Logout</span>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Messages Display -->
                <div id="chat-messages" class="chat-messages">
                    <div class="ai-message message-box">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fas fa-robot text-white"></i>
                            <span class="font-semibold">AI Assistant</span>
                        </div>
                        <p>Hello! I'm your AI assistant. How can I help you today? ðŸš€</p>
                    </div>
                </div>                <!-- Typing Indicator -->
                <div id="typing-indicator" class="typing-indicator">
                    <div class="thinking-animation">
                        <i class="fas fa-brain brain-icon"></i>
                        <span>AI is thinking...</span>
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>

                <!-- Chat Input Area -->
                <div class="chat-input-area">
                    <div class="input-container">                        <textarea 
                            id="chat-input" 
                            class="chat-input" 
                            rows="1" 
                            placeholder="Type your message here... Press Enter to send, Shift+Enter for new line"
                            oninput="autoExpand(this)"
                        ></textarea>
                    </div>
                    <button id="send-message-button" class="send-button" title="Send message">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Profile Page (Static) -->
        <div id="profile-page" class="absolute inset-0 flex items-center justify-center p-4 transition-all duration-500 opacity-0 translate-x-full z-10">
            <div class="profile-container text-gray-800">
                <button id="back-to-chat-button" class="absolute top-4 left-4 p-2 rounded-full hover:bg-gray-100 transition-colors duration-200">
                    <i class="fas fa-arrow-left text-gray-600 text-xl"></i>
                </button>
                <div class="profile-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <h2 id="profile-display-username" class="text-3xl font-bold mb-2">User</h2>
                <p id="profile-display-email" class="text-gray-600 mb-1">user@example.com</p>
                <p id="profile-display-phone" class="text-gray-600 mb-6">N/A</p>

                <div class="space-y-4 text-left">
                    <div class="flex items-center p-4 bg-gray-50 rounded-lg shadow-sm">
                        <i class="fas fa-id-badge text-purple-600 text-2xl mr-4"></i>
                        <div>
                            <p class="font-semibold">User ID</p>
                            <p id="profile-display-uid" class="text-sm text-gray-700 break-all">N/A</p>
                        </div>
                    </div>
                    <div class="flex items-center p-4 bg-gray-50 rounded-lg shadow-sm">
                        <i class="fas fa-lock text-purple-600 text-2xl mr-4"></i>
                        <div>
                            <p class="font-semibold">Security</p>
                            <p class="text-sm text-gray-700">Manage your password and security settings.</p>
                        </div>
                        <button class="ml-auto text-purple-600 hover:text-purple-800 font-medium">Manage</button>
                    </div>
                    <div class="flex items-center p-4 bg-gray-50 rounded-lg shadow-sm">
                        <i class="fas fa-cogs text-purple-600 text-2xl mr-4"></i>
                        <div>
                            <p class="font-semibold">Settings</p>
                            <p class="text-sm text-gray-700">Customize your app preferences.</p>
                        </div>
                        <button class="ml-auto text-purple-600 hover:text-purple-800 font-medium">Open</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Static JS for UI only -->    <script>
        // --- Configuration ---
        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
            ? 'http://localhost:3001' 
            : `http://${window.location.hostname}:3001`;
        
        // --- UI State Management ---
        const loginPage = document.getElementById('login-page');
        const signupPage = document.getElementById('signup-page');
        const chatApp = document.getElementById('chat-app');
        const profilePage = document.getElementById('profile-page');
        const appContainer = document.getElementById('app-container');

        function showApp(pageId) {
            const pages = [loginPage, signupPage, chatApp, profilePage];
            pages.forEach(page => {
                if (page.id === pageId) {
                    page.classList.remove('opacity-0', '-translate-x-full', 'hidden');
                    page.classList.add('opacity-100', 'translate-x-0');
                    page.classList.add('slide-in');
                    setTimeout(() => page.classList.remove('slide-in'), 600);
                    if (pageId === 'chat-app') {
                        // Special case for chat app to initialize chat history
                        loadChatHistory();
                    }
                } else {
                    page.classList.add('opacity-0', 'translate-x-full', 'hidden');
                    page.classList.remove('opacity-100', 'translate-x-0');
                }
            });
        }

        // --- Login & Signup ---
        document.getElementById('show-signup').addEventListener('click', function(e) {
            e.preventDefault();
            showApp('signup-page');
        });

        document.getElementById('show-login').addEventListener('click', function(e) {
            e.preventDefault();
            showApp('login-page');
        });

        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            // Perform login (real backend)
            const usernameOrEmail = document.getElementById('login-email-username').value;
            const password = document.getElementById('login-password').value;
            try {
                const res = await fetch(`${API_BASE_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ usernameOrEmail, password })
                });
                const data = await res.json();
                if (res.ok) {
                    window.currentUser = data;
                    document.getElementById('profile-username-display').innerText = data.username;
                    document.getElementById('profile-display-username').innerText = data.username;
                    document.getElementById('profile-display-email').innerText = data.email;
                    document.getElementById('profile-display-phone').innerText = data.phone || 'N/A';
                    document.getElementById('profile-display-uid').innerText = data.userId;
                    showApp('chat-app');
                } else {
                    alert(data.error || 'Login failed.');
                }
            } catch (err) {
                alert('Network error. Please try again.');
            }
        });

        document.getElementById('signup-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            // Perform signup (real backend)
            const username = document.getElementById('signup-username').value;
            const email = document.getElementById('signup-email').value;
            const phone = document.getElementById('signup-phone').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm-password').value;

            if (password !== confirmPassword) {
                alert('Passwords do not match.');
                return;
            }
            try {
                const res = await fetch(`${API_BASE_URL}/signup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password, phone })
                });
                const data = await res.json();
                if (res.ok) {
                    alert('Signup successful! You can now log in.');
                    showApp('login-page');
                } else {
                    alert(data.error || 'Signup failed.');
                }
            } catch (err) {
                alert('Network error. Please try again.');
            }
        });

        // --- Parallax Effect ---
        document.addEventListener('mousemove', (e) => {
            const parallaxBg = document.getElementById('parallax-bg');
            const x = (e.clientX / window.innerWidth - 0.5) * 40;
            const y = (e.clientY / window.innerHeight - 0.5) * 40;
            parallaxBg.style.transform = `translate(${x}px, ${y}px) scale(1.05)`;
            parallaxBg.classList.add('active');
            clearTimeout(window._parallaxTimeout);
            window._parallaxTimeout = setTimeout(() => parallaxBg.classList.remove('active'), 400);
        });
        // Animate page transitions
        function showApp(pageId) {
            const pages = [loginPage, signupPage, chatApp, profilePage];
            pages.forEach(page => {
                if (page.id === pageId) {
                    page.classList.remove('opacity-0', '-translate-x-full', 'hidden');
                    page.classList.add('opacity-100', 'translate-x-0', 'slide-in', 'modal-pop');
                    setTimeout(() => {
                        page.classList.remove('slide-in', 'modal-pop');
                    }, 700);
                    if (pageId === 'chat-app') {
                        loadChatHistory();
                    }
                } else {
                    page.classList.add('opacity-0', 'translate-x-full', 'hidden');
                    page.classList.remove('opacity-100', 'translate-x-0', 'slide-in', 'modal-pop');
                }
            });
        }        // --- Sidebar and Menu Functionality ---
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const menuButton = document.getElementById('menu-button');
        const userMenuButton = document.getElementById('user-menu-button');
        const userDropdown = document.getElementById('user-dropdown');

        // Sidebar toggle
        function toggleSidebar() {
            sidebar.classList.toggle('open');
            sidebarOverlay.classList.toggle('open');
        }

        function closeSidebar() {
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('open');
        }

        // User menu toggle
        function toggleUserMenu() {
            userDropdown.classList.toggle('open');
        }

        function closeUserMenu() {
            userDropdown.classList.remove('open');
        }

        // Event listeners
        menuButton.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', closeSidebar);
        userMenuButton.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleUserMenu();
        });

        // Close user menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!userMenuButton.contains(e.target) && !userDropdown.contains(e.target)) {
                closeUserMenu();
            }
        });

        // --- Chat Functionality (AI Integrated) ---
        let chatHistory = [];
        let currentChatId = null;        function addMessageToChat(message, sender, isHistory = false) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            
            // Clean up the message content - remove extra whitespace and newlines
            const cleanMessage = message.toString().trim().replace(/\s+/g, ' ');
            
            // Determine message size class based on text length
            let sizeClass = 'short-message';
            if (cleanMessage.length > 200) {
                sizeClass = 'long-message';
            } else if (cleanMessage.length > 100) {
                sizeClass = 'medium-message';
            }
            
            messageDiv.className = `message-box ${sender}-message ${sizeClass}`;
            
            // Create scrollable content container for long messages
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="flex items-center gap-2 mb-2 justify-end">
                        <span class="font-semibold">You</span>
                        <i class="fas fa-user"></i>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fas fa-robot"></i>
                        <span class="font-semibold">AI Assistant</span>
                    </div>
                `;
            }
            
            // Handle very long messages with expand/collapse
            if (cleanMessage.length > 1000) {
                const truncatedMessage = cleanMessage.substring(0, 500) + '...';
                contentDiv.innerHTML = `
                    <p class="message-text">${truncatedMessage}</p>
                    <button class="expand-btn text-xs underline mt-2 opacity-75 hover:opacity-100 cursor-pointer">Show more</button>
                `;
                
                const expandBtn = contentDiv.querySelector('.expand-btn');
                const messageText = contentDiv.querySelector('.message-text');
                let isExpanded = false;
                
                expandBtn.addEventListener('click', function() {
                    if (!isExpanded) {
                        messageText.textContent = cleanMessage;
                        expandBtn.textContent = 'Show less';
                        isExpanded = true;
                        contentDiv.scrollTop = 0;
                    } else {
                        messageText.textContent = truncatedMessage;
                        expandBtn.textContent = 'Show more';
                        isExpanded = false;
                    }
                });
            } else {
                contentDiv.innerHTML = `<p class="mb-0">${cleanMessage}</p>`;
            }
            
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            
            // Auto-scroll for long messages within the message box
            setTimeout(() => {
                if (message.length > 500) {
                    contentDiv.scrollTop = 0;
                }
            }, 100);
              // Add to current chat history
            if (!isHistory && currentChatId) {
                const chat = chatHistory.find(c => c.id === currentChatId);
                if (chat) {
                    chat.messages.push({ sender, message: cleanMessage, timestamp: new Date() });
                    updateChatHistoryDisplay();
                }
            }
            
            // Smooth scroll chat container to bottom
            if (!isHistory) {
                setTimeout(() => {
                    chatMessages.scrollTo({
                        top: chatMessages.scrollHeight,
                        behavior: 'smooth'
                    });
                }, 50);
            }
        }

        function updateChatHistoryDisplay() {
            const historyList = document.getElementById('chat-history-list');
            historyList.innerHTML = '';
            
            chatHistory.forEach(chat => {
                const historyItem = document.createElement('button');
                historyItem.className = `chat-history-item ${chat.id === currentChatId ? 'active' : ''}`;
                
                const lastMessage = chat.messages[chat.messages.length - 1];
                const preview = lastMessage ? lastMessage.message.substring(0, 50) + '...' : 'New chat';
                
                historyItem.innerHTML = `
                    <div class="font-medium">${chat.title}</div>
                    <div class="chat-preview">${preview}</div>
                `;
                
                historyItem.onclick = () => loadChat(chat.id);
                historyList.appendChild(historyItem);
            });
        }

        function createNewChat() {
            const chatId = 'chat_' + Date.now();
            const newChat = {
                id: chatId,
                title: 'New Chat',
                messages: [],
                createdAt: new Date()
            };
            
            chatHistory.unshift(newChat);
            currentChatId = chatId;
            
            // Clear chat messages
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML = `
                <div class="ai-message message-box">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fas fa-robot"></i>
                        <span class="font-semibold">AI Assistant</span>
                    </div>
                    <p>Hello! I'm your AI assistant. How can I help you today? ðŸš€</p>
                </div>
            `;
            
            document.getElementById('current-chat-title').innerText = 'AI Assistant';
            updateChatHistoryDisplay();
            closeSidebar();
        }

        function loadChat(chatId) {
            const chat = chatHistory.find(c => c.id === chatId);
            if (!chat) return;
            
            currentChatId = chatId;
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML = '';
            
            // Add welcome message
            const welcomeDiv = document.createElement('div');
            welcomeDiv.className = 'ai-message message-box';
            welcomeDiv.innerHTML = `
                <div class="flex items-center gap-2 mb-2">
                    <i class="fas fa-robot"></i>
                    <span class="font-semibold">AI Assistant</span>
                </div>
                <p>Hello! I'm your AI assistant. How can I help you today? ðŸš€</p>
            `;
            chatMessages.appendChild(welcomeDiv);
            
            // Load chat messages
            chat.messages.forEach(msg => {
                addMessageToChat(msg.message, msg.sender, true);
            });
            
            // Smooth scroll to bottom after loading
            setTimeout(() => {
                chatMessages.scrollTo({
                    top: chatMessages.scrollHeight,
                    behavior: 'smooth'
                });
            }, 100);
            
            document.getElementById('current-chat-title').innerText = chat.title;
            updateChatHistoryDisplay();
            closeSidebar();
        }

        function loadChatHistory() {
            if (chatHistory.length === 0) {
                createNewChat();
            } else {
                updateChatHistoryDisplay();
            }
        }

        // New chat button event listener
        document.getElementById('new-chat-btn').addEventListener('click', createNewChat);        // --- Message Sending Functionality ---
        function sendMessage() {
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-message-button');
            const message = chatInput.value.trim();
            
            if (!message) return;
            
            // Disable input and button while processing
            chatInput.disabled = true;
            sendButton.disabled = true;
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            
            // Clear input and reset height
            chatInput.value = '';
            chatInput.style.height = '50px';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Make API call to backend which connects to Ollama
            sendToOllama(message).then(response => {
                hideTypingIndicator();
                addMessageToChat(response, 'ai');
                
                // Re-enable input and button
                chatInput.disabled = false;
                sendButton.disabled = false;
                chatInput.focus();            }).catch(error => {
                hideTypingIndicator();
                console.error('Error sending message to Ollama:', error);
                
                // Show user-friendly error message based on error type
                let errorMessage;
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    errorMessage = "ðŸ”Œ Unable to connect to the AI service. Please make sure the backend server is running.";
                } else if (error.message.includes('500')) {
                    errorMessage = "ðŸ¤– The AI model is currently unavailable. Please make sure Ollama is running with the llama3.2 model.";
                } else {
                    errorMessage = "âš ï¸ Sorry, I'm having trouble processing your request. Please try again.";
                }
                
                addMessageToChat(errorMessage, 'ai');
                
                // Re-enable input and button
                chatInput.disabled = false;
                sendButton.disabled = false;
                chatInput.focus();
            });
        }
          async function sendToOllama(message) {
            try {
                const response = await fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: message })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                // Clean up the AI response - remove extra whitespace and newlines
                const cleanReply = (data.reply || "I'm sorry, I couldn't generate a response.").toString().trim().replace(/\s+/g, ' ');
                return cleanReply;
            } catch (error) {
                console.error('Ollama API error:', error);
                throw error;
            }
        }
        function showTypingIndicator() {
            const typingIndicator = document.querySelector('.typing-indicator');
            if (typingIndicator) {
                typingIndicator.style.display = 'flex';
            }
        }
        
        function hideTypingIndicator() {
            const typingIndicator = document.querySelector('.typing-indicator');
            if (typingIndicator) {
                typingIndicator.style.display = 'none';
            }
        }
        
        // Send message button event listener
        document.getElementById('send-message-button').addEventListener('click', sendMessage);
        
        // Enter key event listener for chat input
        document.getElementById('chat-input').addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault(); // Prevent line break
                sendMessage();
            }
            // Allow Shift+Enter for line breaks
        });
        
        // Focus chat input on page load
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chat-input');
            if (chatInput) {
                chatInput.focus();
            }
        });

        // --- Profile and Logout ---
        document.getElementById('profile-menu-item').addEventListener('click', function() {
            closeUserMenu();
            showApp('profile-page');
        });

        document.getElementById('logout-menu-item').addEventListener('click', function() {
            closeUserMenu();
            if (confirm('Are you sure you want to logout?')) {
                // Clear chat history
                chatHistory = [];
                currentChatId = null;
                showApp('login-page');
            }
        });

        document.getElementById('back-to-chat-button').addEventListener('click', function() {
            showApp('chat-app');
        });
        
        // --- Connection Status Checking ---
        async function checkBackendConnection() {
            try {
                const response = await fetch(`${API_BASE_URL}/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    console.log('âœ… Backend server is connected');
                    return true;
                } else {
                    console.log('âŒ Backend server responded with error:', response.status);
                    return false;
                }
            } catch (error) {
                console.log('âŒ Failed to connect to backend server:', error.message);
                return false;
            }
        }        // Check backend connection on page load
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize theme first
            initializeTheme();
            
            // Set up theme toggle button
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', toggleTheme);  
            }
            
            const chatInput = document.getElementById('chat-input');
            if (chatInput) {
                chatInput.focus();
            }
            
            // Check if backend is available
            const backendConnected = await checkBackendConnection();
            if (!backendConnected) {
                console.log('âš ï¸  Backend server is not available. Make sure to start it with: cd backend && npm start');
            } else {
                // Also check Ollama health
                await checkOllamaHealth();
            }
        });
        
        // Check Ollama health through backend
        async function checkOllamaHealth() {
            try {
                const response = await fetch(`${API_BASE_URL}/health/ollama`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.status === 'healthy') {
                    console.log('âœ… Ollama is connected and healthy');
                    console.log(`ðŸ“Š Models available: ${data.models_available}`);
                    console.log(`ðŸ¤– Required model available: ${data.required_model_available ? 'âœ…' : 'âŒ'}`);
                    if (data.models && data.models.length > 0) {
                        console.log('ðŸ” Available models:', data.models.join(', '));
                    }
                    
                    if (!data.required_model_available) {
                        console.log('âš ï¸  llama3.2:1b-instruct-q4_K_M model is not available. Please ensure it is downloaded.');
                    }
                } else {
                    console.log('âŒ Ollama health check failed:', data);
                }
            } catch (error) {
                console.log('âŒ Failed to check Ollama health:', error.message);
            }
        }
        
        // --- Theme Toggle Functionality ---
        function initializeTheme() {
            // Check for saved theme preference or default to light mode
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);
        }

        function setTheme(theme) {
            const html = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');
            
            if (theme === 'dark') {
                html.setAttribute('data-theme', 'dark');
                if (themeIcon) themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'dark');
            } else {
                html.removeAttribute('data-theme');
                if (themeIcon) themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'light');
            }
        }

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        }

        // Initialize theme on page load
        document.addEventListener('DOMContentLoaded', initializeTheme);
        
        // Theme toggle button event listener
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    </script>
</body>
</html>
